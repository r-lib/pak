<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Authenticated repositories — Authenticated repositories • pak</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Authenticated repositories — Authenticated repositories"><meta name="description" content="pak supports HTTP basic authentication when interacting with CRAN-like
repositories.
Configuring authenticated repositories


To use authentication you need to include a user name in the repository
URL. You can set the repository URL in the repos option with
base::options() as usual, or you can use repo_add().
For testing purposes pak includes a web app that creates an authenticated
proxy to CRAN. This is how to run the proxy in a subprocess:
repo &amp;lt;- webfakes::new_app_process(pak:::auth_proxy_app())
repo$url()
#&amp;gt; [1] &quot;http://127.0.0.1:59571/&quot;

(This needs the webfakes and callr packages.)
Next, we configure the proxy as the main CRAN repository. The default username
of the proxy is &quot;username&quot; and the default password is &quot;token&quot;. We want to
replace the default CRAN repository with the proxy, so we name it CRAN:
repo_add(CRAN = repo$url(), username = &quot;username&quot;)
repo_get()
#&amp;gt; x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt; # A data frame: 6 x 7
#&amp;gt;   name          url           type  r_version bioc_version username has_password
#&amp;gt; * &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;
#&amp;gt; 1 CRAN          http://usern~ cran  *         &amp;lt;NA&amp;gt;         username FALSE
#&amp;gt; 2 BioCsoft      https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 3 BioCann       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 4 BioCexp       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 5 BioCworkflows https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 6 BioCbooks     https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA

Note that the output includes a username and a has_password column.
These are only present if at least one configured repository needs
authentication. has_password is FALSE here, because pak did not find
the credentials for this repository.
repo_get() also displays a message if it cannot find the credentials
for an authenticated repository.
Next we are going to store the credentials in a place where pak can find
them.



Credential lookup


pak can look up credentials from two sources:
The current user's netrc file.
The system credential store via the keyring package. pak comes with its
own copy of the keyring package, you don't need to install it
separately.


netrc files


If the NETRC environment variable is set, pak uses its value to
determine the location of the netrc file.
Otherwise pak looks for the netrc file in current user's home
directory, at ~/.netrc. On Windows it also looks for ~/_netrc if the
file starting with a dot does not exist.
If you create a netrc file, make sure that is only readable by you.
E.g. on Unix run
chmod 600 ~/.netrc

netrc files are simple text files that can store passwords for multiple
hosts. They may contain three types of tokens:
machine &amp;lt;hostname&amp;gt;


A host name, without the protocol. Subsequent login and password
tokens belong to this host, until another machine token is found, or
the end of file.



login &amp;lt;username&amp;gt;


User name. It must be preceded by a machine token.



password &amp;lt;password&amp;gt;


Password. It must be preceded by a machine and a login token.
Whitespace is ignored in netrc files. You may include multiple tokens
on the same line, or have one token per line. Here is an example:
machine myhost.mydomain.com login myuser password secret
machine myhost2.mydomain.com
login myuser
password secret
login anotheruser
password stillsecret

If you need to include whitespace in a password, put the password in double
quotes.






The credential store


pak uses the keyring package to query the system credential store (or an
alternative keyring credential store) to find credentials for authenticated
repositories. pak comes with a copy of the keyring package, so you don't
need to install it separately.
To store a repository password in the system credential store use the
repo_auth_key_set() function. If you want to use a non-default keyring
backend, set the keyring_backend option. In this manual we will use
the backend that stores secrets in environment variables. This is an
ephemeral store that is destroyed when the R process terminates.
To continue our example from above:
options(keyring_backend = &quot;env&quot;)
repo_auth_key_set(repo$url(), username = &quot;username&quot;, password = &quot;token&quot;)

Use repo_auth_key_get() to check that the key is properly set:
repo_auth_key_get(repo$url(), username = &quot;username&quot;)
#&amp;gt; [1] &quot;token&quot;

repo_get() now does not show a warning message, and also sets the
has_password column to TRUE, because pak could find the credentials
for our CRAN proxy:
repo_get()
#&amp;gt; x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt; # A data frame: 6 x 7
#&amp;gt;   name          url           type  r_version bioc_version username has_password
#&amp;gt; * &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;
#&amp;gt; 1 CRAN          http://usern~ cran  *         &amp;lt;NA&amp;gt;         username FALSE
#&amp;gt; 2 BioCsoft      https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 3 BioCann       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 4 BioCexp       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 5 BioCworkflows https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 6 BioCbooks     https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA




Repo vs. host credentials


pak handles credentials for repositories and hosts. A repository
credential's key is a URL with a non-empty path:
https://repo.host.com/repos/repo1

A host credential's is an URL with an empty path:
https://repo.host.com

pak always looks for repository credentials first. If it does not find
any credentials for a repository then it drops the path and looks for
host credentials.
Because netrc files only store domain names and not URLs, they can only
contain host credentials.






Testing


To test that authentication works, use the repo_status() function:
repo_status()
#&amp;gt; x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt; # A data frame: 12 x 12
#&amp;gt;    name  url   type  bioc_version username has_password platform path  r_version
#&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
#&amp;gt;  1 CRAN  http~ cran  &amp;lt;NA&amp;gt;         username FALSE        source   src/~ 4.4
#&amp;gt;  2 CRAN  http~ cran  &amp;lt;NA&amp;gt;         username FALSE        aarch64~ bin/~ 4.4
#&amp;gt;  3 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt;  4 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt;  5 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt;  6 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt;  7 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt;  8 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt;  9 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt; 10 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt; 11 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt; 12 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt; # i 3 more variables: ok &amp;lt;lgl&amp;gt;, ping &amp;lt;dbl&amp;gt;, error &amp;lt;list&amp;gt;

The output of repo_status() has extra columns, compared to repo_get(),
and it also has a separate row for each platform. If everything works,
then the has_password column is TRUE for authenticated repositories,
and the ok column is TRUE if repo_status() was able to perform
an (authenticated) HTTP HEAD request to the metadata file of a platform in
a repository.
If you need even more information about repo authentication, e.g. because
repo_status() shows some failures, then use the repo_auth() function:
repo_auth()
#&amp;gt; v Found credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt; (keyring:env).
#&amp;gt; # A data frame: 1 x 11
#&amp;gt;   name  url              type  r_version bioc_version username has_password auth_domains auth_domain
#&amp;gt; * &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;            &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;        &amp;lt;I&amp;lt;list&amp;gt;&amp;gt;    &amp;lt;chr&amp;gt;
#&amp;gt; 1 CRAN  http://username~ cran  *         &amp;lt;NA&amp;gt;         username TRUE         &amp;lt;chr [4]&amp;gt;    http://127~
#&amp;gt; # i 2 more variables: auth_source &amp;lt;chr&amp;gt;, auth_error &amp;lt;chr&amp;gt;

The output of repo_auth() has the following extra columns:
auth_domains: these are the URLs that pak tries to use as the service
when looking for credentials in the keyring. For our proxy, it tries
these URLs:
repo_auth()$auth_domains
#&amp;gt; v Found credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt; (keyring:env).
#&amp;gt; [[1]]
#&amp;gt; [1] &quot;http://username@127.0.0.1:59571/&quot; &quot;http://127.0.0.1:59571/&quot;
#&amp;gt; [3] &quot;http://username@127.0.0.1:59571&quot;  &quot;http://127.0.0.1:59571&quot;

auth_domain: one of auth_domains, the URL for which pak found
credentials in the keyring. If no credentials were found, then this is
NA.
auth_source: a short string that explains where pak found the
credentials (or NA if not credentials were found). For examples
netrc means the user's netrc file, and keyring:macos means the
macOS system credential store.
auth_error: NA for successful credential search, otherwise a short
error message on why the search failed. Typically it would fail is the
credentials are not in the credential store.





Usage


Once you set up your authenticated repositories, and stored the required
passwords in the system credential store, you can use them like any
other repository. Operations that need authentication will always include
reassuring messages for successful authentications, and warning messages
for failed ones. Function calls that do not perform any HTTP requests,
e.g. because they list cached data, do not display such messages.
meta_update()
#&amp;gt; Checking for 15 new metadata files
#&amp;gt; ! Cannot find credentials for URL &amp;lt;http://username@127.0.0.1:59571//bin/macosx/big-sur-arm64/contrib/4.4/PACKAGES.gz&amp;gt;, credential lookup
#&amp;gt; failed. Keyring backend: &quot;macos&quot;.
#&amp;gt; Checking for 15 new metadata files
x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt;
#&amp;gt; i R 4.4 aarch64-apple-darwin20 packages are missing from CRAN: Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server and Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server
#&amp;gt; i source packages are missing from CRAN: Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server and Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server
#&amp;gt; i Updating metadata database
#&amp;gt; v Updating metadata database ... done

meta_list()
#&amp;gt; # A data frame: 50,701 x 33
#&amp;gt;    package    version depends suggests license md5sum sha256sum needscompilation
#&amp;gt;    &amp;lt;chr&amp;gt;      &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;
#&amp;gt;  1 A3         1.0.0   R (&amp;gt;= ~ randomF~ GPL (&amp;gt;~ 929a4~ &quot;\n     ~ no
#&amp;gt;  2 AATtools   0.0.3   R (&amp;gt;= ~ &amp;lt;NA&amp;gt;     GPL-3   de2ec~ &quot;\n     ~ no
#&amp;gt;  3 ABACUS     1.0.0   R (&amp;gt;= ~ rmarkdo~ GPL-3   28795~ &quot;\n     ~ no
#&amp;gt;  4 ABC.RAP    0.9.0   R (&amp;gt;= ~ knitr, ~ GPL-3   0158e~ &quot;\n     ~ no
#&amp;gt;  5 ABCanalys~ 1.2.1   R (&amp;gt;= ~ &amp;lt;NA&amp;gt;     GPL-3   4cbe1~ &quot;\n     ~ no
#&amp;gt;  6 ABCoptim   0.15.0  &amp;lt;NA&amp;gt;    testtha~ MIT + ~ a294d~ &quot;\n     ~ yes
#&amp;gt;  7 ABCp2      1.2     MASS    &amp;lt;NA&amp;gt;     GPL-2   d049b~  &amp;lt;NA&amp;gt;     no
#&amp;gt;  8 ABHgenoty~ 1.0.1   &amp;lt;NA&amp;gt;    knitr, ~ GPL-3   fce25~ &quot;\n     ~ no
#&amp;gt;  9 ABM        0.4.3   &amp;lt;NA&amp;gt;    &amp;lt;NA&amp;gt;     GPL (&amp;gt;~ 7aaae~ &quot;\n     ~ yes
#&amp;gt; 10 ABPS       0.3     &amp;lt;NA&amp;gt;    testthat GPL (&amp;gt;~ d3f00~ &quot;\n     ~ no
#&amp;gt; # i 50,691 more rows
#&amp;gt; # i 25 more variables: imports &amp;lt;chr&amp;gt;, linkingto &amp;lt;chr&amp;gt;, archs &amp;lt;chr&amp;gt;,
#&amp;gt; #   enhances &amp;lt;chr&amp;gt;, license_restricts_use &amp;lt;chr&amp;gt;, priority &amp;lt;chr&amp;gt;, os_type &amp;lt;chr&amp;gt;,
#&amp;gt; #   license_is_foss &amp;lt;chr&amp;gt;, repodir &amp;lt;chr&amp;gt;, rversion &amp;lt;chr&amp;gt;, platform &amp;lt;chr&amp;gt;,
#&amp;gt; #   ref &amp;lt;chr&amp;gt;, type &amp;lt;chr&amp;gt;, direct &amp;lt;lgl&amp;gt;, status &amp;lt;chr&amp;gt;, target &amp;lt;chr&amp;gt;,
#&amp;gt; #   mirror &amp;lt;chr&amp;gt;, sources &amp;lt;list&amp;gt;, filesize &amp;lt;int&amp;gt;, sha256 &amp;lt;chr&amp;gt;, sysreqs &amp;lt;chr&amp;gt;,
#&amp;gt; #   built &amp;lt;chr&amp;gt;, published &amp;lt;dttm&amp;gt;, deps &amp;lt;list&amp;gt;, path &amp;lt;chr&amp;gt;

E.g. here meta_update() outputs an authentication message, but
meta_list() does not.

"><meta property="og:description" content="pak supports HTTP basic authentication when interacting with CRAN-like
repositories.
Configuring authenticated repositories


To use authentication you need to include a user name in the repository
URL. You can set the repository URL in the repos option with
base::options() as usual, or you can use repo_add().
For testing purposes pak includes a web app that creates an authenticated
proxy to CRAN. This is how to run the proxy in a subprocess:
repo &amp;lt;- webfakes::new_app_process(pak:::auth_proxy_app())
repo$url()
#&amp;gt; [1] &quot;http://127.0.0.1:59571/&quot;

(This needs the webfakes and callr packages.)
Next, we configure the proxy as the main CRAN repository. The default username
of the proxy is &quot;username&quot; and the default password is &quot;token&quot;. We want to
replace the default CRAN repository with the proxy, so we name it CRAN:
repo_add(CRAN = repo$url(), username = &quot;username&quot;)
repo_get()
#&amp;gt; x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt; # A data frame: 6 x 7
#&amp;gt;   name          url           type  r_version bioc_version username has_password
#&amp;gt; * &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;
#&amp;gt; 1 CRAN          http://usern~ cran  *         &amp;lt;NA&amp;gt;         username FALSE
#&amp;gt; 2 BioCsoft      https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 3 BioCann       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 4 BioCexp       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 5 BioCworkflows https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 6 BioCbooks     https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA

Note that the output includes a username and a has_password column.
These are only present if at least one configured repository needs
authentication. has_password is FALSE here, because pak did not find
the credentials for this repository.
repo_get() also displays a message if it cannot find the credentials
for an authenticated repository.
Next we are going to store the credentials in a place where pak can find
them.



Credential lookup


pak can look up credentials from two sources:
The current user's netrc file.
The system credential store via the keyring package. pak comes with its
own copy of the keyring package, you don't need to install it
separately.


netrc files


If the NETRC environment variable is set, pak uses its value to
determine the location of the netrc file.
Otherwise pak looks for the netrc file in current user's home
directory, at ~/.netrc. On Windows it also looks for ~/_netrc if the
file starting with a dot does not exist.
If you create a netrc file, make sure that is only readable by you.
E.g. on Unix run
chmod 600 ~/.netrc

netrc files are simple text files that can store passwords for multiple
hosts. They may contain three types of tokens:
machine &amp;lt;hostname&amp;gt;


A host name, without the protocol. Subsequent login and password
tokens belong to this host, until another machine token is found, or
the end of file.



login &amp;lt;username&amp;gt;


User name. It must be preceded by a machine token.



password &amp;lt;password&amp;gt;


Password. It must be preceded by a machine and a login token.
Whitespace is ignored in netrc files. You may include multiple tokens
on the same line, or have one token per line. Here is an example:
machine myhost.mydomain.com login myuser password secret
machine myhost2.mydomain.com
login myuser
password secret
login anotheruser
password stillsecret

If you need to include whitespace in a password, put the password in double
quotes.






The credential store


pak uses the keyring package to query the system credential store (or an
alternative keyring credential store) to find credentials for authenticated
repositories. pak comes with a copy of the keyring package, so you don't
need to install it separately.
To store a repository password in the system credential store use the
repo_auth_key_set() function. If you want to use a non-default keyring
backend, set the keyring_backend option. In this manual we will use
the backend that stores secrets in environment variables. This is an
ephemeral store that is destroyed when the R process terminates.
To continue our example from above:
options(keyring_backend = &quot;env&quot;)
repo_auth_key_set(repo$url(), username = &quot;username&quot;, password = &quot;token&quot;)

Use repo_auth_key_get() to check that the key is properly set:
repo_auth_key_get(repo$url(), username = &quot;username&quot;)
#&amp;gt; [1] &quot;token&quot;

repo_get() now does not show a warning message, and also sets the
has_password column to TRUE, because pak could find the credentials
for our CRAN proxy:
repo_get()
#&amp;gt; x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt; # A data frame: 6 x 7
#&amp;gt;   name          url           type  r_version bioc_version username has_password
#&amp;gt; * &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt;         &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;
#&amp;gt; 1 CRAN          http://usern~ cran  *         &amp;lt;NA&amp;gt;         username FALSE
#&amp;gt; 2 BioCsoft      https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 3 BioCann       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 4 BioCexp       https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 5 BioCworkflows https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA
#&amp;gt; 6 BioCbooks     https://bioc~ bioc  4.4.2     3.20         &amp;lt;NA&amp;gt;     NA




Repo vs. host credentials


pak handles credentials for repositories and hosts. A repository
credential's key is a URL with a non-empty path:
https://repo.host.com/repos/repo1

A host credential's is an URL with an empty path:
https://repo.host.com

pak always looks for repository credentials first. If it does not find
any credentials for a repository then it drops the path and looks for
host credentials.
Because netrc files only store domain names and not URLs, they can only
contain host credentials.






Testing


To test that authentication works, use the repo_status() function:
repo_status()
#&amp;gt; x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt; # A data frame: 12 x 12
#&amp;gt;    name  url   type  bioc_version username has_password platform path  r_version
#&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;
#&amp;gt;  1 CRAN  http~ cran  &amp;lt;NA&amp;gt;         username FALSE        source   src/~ 4.4
#&amp;gt;  2 CRAN  http~ cran  &amp;lt;NA&amp;gt;         username FALSE        aarch64~ bin/~ 4.4
#&amp;gt;  3 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt;  4 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt;  5 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt;  6 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt;  7 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt;  8 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt;  9 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt; 10 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt; 11 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           source   src/~ 4.4
#&amp;gt; 12 BioC~ http~ bioc  3.20         &amp;lt;NA&amp;gt;     NA           aarch64~ bin/~ 4.4
#&amp;gt; # i 3 more variables: ok &amp;lt;lgl&amp;gt;, ping &amp;lt;dbl&amp;gt;, error &amp;lt;list&amp;gt;

The output of repo_status() has extra columns, compared to repo_get(),
and it also has a separate row for each platform. If everything works,
then the has_password column is TRUE for authenticated repositories,
and the ok column is TRUE if repo_status() was able to perform
an (authenticated) HTTP HEAD request to the metadata file of a platform in
a repository.
If you need even more information about repo authentication, e.g. because
repo_status() shows some failures, then use the repo_auth() function:
repo_auth()
#&amp;gt; v Found credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt; (keyring:env).
#&amp;gt; # A data frame: 1 x 11
#&amp;gt;   name  url              type  r_version bioc_version username has_password auth_domains auth_domain
#&amp;gt; * &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;            &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;    &amp;lt;lgl&amp;gt;        &amp;lt;I&amp;lt;list&amp;gt;&amp;gt;    &amp;lt;chr&amp;gt;
#&amp;gt; 1 CRAN  http://username~ cran  *         &amp;lt;NA&amp;gt;         username TRUE         &amp;lt;chr [4]&amp;gt;    http://127~
#&amp;gt; # i 2 more variables: auth_source &amp;lt;chr&amp;gt;, auth_error &amp;lt;chr&amp;gt;

The output of repo_auth() has the following extra columns:
auth_domains: these are the URLs that pak tries to use as the service
when looking for credentials in the keyring. For our proxy, it tries
these URLs:
repo_auth()$auth_domains
#&amp;gt; v Found credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt; (keyring:env).
#&amp;gt; [[1]]
#&amp;gt; [1] &quot;http://username@127.0.0.1:59571/&quot; &quot;http://127.0.0.1:59571/&quot;
#&amp;gt; [3] &quot;http://username@127.0.0.1:59571&quot;  &quot;http://127.0.0.1:59571&quot;

auth_domain: one of auth_domains, the URL for which pak found
credentials in the keyring. If no credentials were found, then this is
NA.
auth_source: a short string that explains where pak found the
credentials (or NA if not credentials were found). For examples
netrc means the user's netrc file, and keyring:macos means the
macOS system credential store.
auth_error: NA for successful credential search, otherwise a short
error message on why the search failed. Typically it would fail is the
credentials are not in the credential store.





Usage


Once you set up your authenticated repositories, and stored the required
passwords in the system credential store, you can use them like any
other repository. Operations that need authentication will always include
reassuring messages for successful authentications, and warning messages
for failed ones. Function calls that do not perform any HTTP requests,
e.g. because they list cached data, do not display such messages.
meta_update()
#&amp;gt; Checking for 15 new metadata files
#&amp;gt; ! Cannot find credentials for URL &amp;lt;http://username@127.0.0.1:59571//bin/macosx/big-sur-arm64/contrib/4.4/PACKAGES.gz&amp;gt;, credential lookup
#&amp;gt; failed. Keyring backend: &quot;macos&quot;.
#&amp;gt; Checking for 15 new metadata files
x Did not find credentials for repo &amp;lt;http://username@127.0.0.1:59571/&amp;gt;, keyring
#&amp;gt; lookup failed (macos backend).
#&amp;gt;
#&amp;gt; i R 4.4 aarch64-apple-darwin20 packages are missing from CRAN: Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server and Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server
#&amp;gt; i source packages are missing from CRAN: Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server and Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server
#&amp;gt; i Updating metadata database
#&amp;gt; v Updating metadata database ... done

meta_list()
#&amp;gt; # A data frame: 50,701 x 33
#&amp;gt;    package    version depends suggests license md5sum sha256sum needscompilation
#&amp;gt;    &amp;lt;chr&amp;gt;      &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;     &amp;lt;chr&amp;gt;
#&amp;gt;  1 A3         1.0.0   R (&amp;gt;= ~ randomF~ GPL (&amp;gt;~ 929a4~ &quot;\n     ~ no
#&amp;gt;  2 AATtools   0.0.3   R (&amp;gt;= ~ &amp;lt;NA&amp;gt;     GPL-3   de2ec~ &quot;\n     ~ no
#&amp;gt;  3 ABACUS     1.0.0   R (&amp;gt;= ~ rmarkdo~ GPL-3   28795~ &quot;\n     ~ no
#&amp;gt;  4 ABC.RAP    0.9.0   R (&amp;gt;= ~ knitr, ~ GPL-3   0158e~ &quot;\n     ~ no
#&amp;gt;  5 ABCanalys~ 1.2.1   R (&amp;gt;= ~ &amp;lt;NA&amp;gt;     GPL-3   4cbe1~ &quot;\n     ~ no
#&amp;gt;  6 ABCoptim   0.15.0  &amp;lt;NA&amp;gt;    testtha~ MIT + ~ a294d~ &quot;\n     ~ yes
#&amp;gt;  7 ABCp2      1.2     MASS    &amp;lt;NA&amp;gt;     GPL-2   d049b~  &amp;lt;NA&amp;gt;     no
#&amp;gt;  8 ABHgenoty~ 1.0.1   &amp;lt;NA&amp;gt;    knitr, ~ GPL-3   fce25~ &quot;\n     ~ no
#&amp;gt;  9 ABM        0.4.3   &amp;lt;NA&amp;gt;    &amp;lt;NA&amp;gt;     GPL (&amp;gt;~ 7aaae~ &quot;\n     ~ yes
#&amp;gt; 10 ABPS       0.3     &amp;lt;NA&amp;gt;    testthat GPL (&amp;gt;~ d3f00~ &quot;\n     ~ no
#&amp;gt; # i 50,691 more rows
#&amp;gt; # i 25 more variables: imports &amp;lt;chr&amp;gt;, linkingto &amp;lt;chr&amp;gt;, archs &amp;lt;chr&amp;gt;,
#&amp;gt; #   enhances &amp;lt;chr&amp;gt;, license_restricts_use &amp;lt;chr&amp;gt;, priority &amp;lt;chr&amp;gt;, os_type &amp;lt;chr&amp;gt;,
#&amp;gt; #   license_is_foss &amp;lt;chr&amp;gt;, repodir &amp;lt;chr&amp;gt;, rversion &amp;lt;chr&amp;gt;, platform &amp;lt;chr&amp;gt;,
#&amp;gt; #   ref &amp;lt;chr&amp;gt;, type &amp;lt;chr&amp;gt;, direct &amp;lt;lgl&amp;gt;, status &amp;lt;chr&amp;gt;, target &amp;lt;chr&amp;gt;,
#&amp;gt; #   mirror &amp;lt;chr&amp;gt;, sources &amp;lt;list&amp;gt;, filesize &amp;lt;int&amp;gt;, sha256 &amp;lt;chr&amp;gt;, sysreqs &amp;lt;chr&amp;gt;,
#&amp;gt; #   built &amp;lt;chr&amp;gt;, published &amp;lt;dttm&amp;gt;, deps &amp;lt;list&amp;gt;, path &amp;lt;chr&amp;gt;

E.g. here meta_update() outputs an authentication message, but
meta_list() does not.

"><meta name="robots" content="noindex"><script defer data-domain="/pak.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pak</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.9.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/get-started.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/faq.html">FAQ</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/pak/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Authenticated repositories</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/pak/blob/main/R/auth.R" class="external-link"><code>R/auth.R</code></a></small>
      <div class="d-none name"><code>repo-auth.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>pak supports HTTP basic authentication when interacting with CRAN-like
repositories.</p><div class="section">
<h3 id="configuring-authenticated-repositories">Configuring authenticated repositories<a class="anchor" aria-label="anchor" href="#configuring-authenticated-repositories"></a></h3>


<p>To use authentication you need to include a user name in the repository
URL. You can set the repository URL in the <code>repos</code> option with
<code><a href="https://rdrr.io/r/base/options.html" class="external-link">base::options()</a></code> as usual, or you can use <code><a href="repo_add.html">repo_add()</a></code>.</p>
<p>For testing purposes pak includes a web app that creates an authenticated
proxy to CRAN. This is how to run the proxy in a subprocess:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">repo</span> <span class="op">&lt;-</span> <span class="fu">webfakes</span><span class="fu">::</span><span class="fu"><a href="https://webfakes.r-lib.org/reference/new_app_process.html" class="external-link">new_app_process</a></span><span class="op">(</span><span class="fu">pak</span><span class="fu">:::</span><span class="fu">auth_proxy_app</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">repo</span><span class="op">$</span><span class="fu">url</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "http://127.0.0.1:59571/"</span></span></code></pre><p></p></div>
<p>(This needs the webfakes and callr packages.)</p>
<p>Next, we configure the proxy as the main CRAN repository. The default username
of the proxy is <code>"username"</code> and the default password is <code>"token"</code>. We want to
replace the default CRAN repository with the proxy, so we name it <code>CRAN</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/repo_add.html">repo_add</a></span><span class="op">(</span>CRAN <span class="op">=</span> <span class="va">repo</span><span class="op">$</span><span class="fu">url</span><span class="op">(</span><span class="op">)</span>, username <span class="op">=</span> <span class="st">"username"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/repo_get.html">repo_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; x Did not find credentials for repo &lt;http://username@127.0.0.1:59571/&gt;, keyring</span></span>
<span><span class="co">#&gt; lookup failed (macos backend).</span></span>
<span><span class="co">#&gt; # A data frame: 6 x 7</span></span>
<span><span class="co">#&gt;   name          url           type  r_version bioc_version username has_password</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;    &lt;lgl&gt;</span></span>
<span><span class="co">#&gt; 1 CRAN          http://usern~ cran  *         &lt;NA&gt;         username FALSE</span></span>
<span><span class="co">#&gt; 2 BioCsoft      https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 3 BioCann       https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 4 BioCexp       https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 5 BioCworkflows https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 6 BioCbooks     https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span></code></pre><p></p></div>
<p>Note that the output includes a <code>username</code> and a <code>has_password</code> column.
These are only present if at least one configured repository needs
authentication. <code>has_password</code> is <code>FALSE</code> here, because pak did not find
the credentials for this repository.</p>
<p><code><a href="repo_get.html">repo_get()</a></code> also displays a message if it cannot find the credentials
for an authenticated repository.</p>
<p>Next we are going to store the credentials in a place where pak can find
them.</p>
</div>

<div class="section">
<h3 id="credential-lookup">Credential lookup<a class="anchor" aria-label="anchor" href="#credential-lookup"></a></h3>


<p>pak can look up credentials from two sources:</p><ol><li><p>The current user's <code>netrc</code> file.</p></li>
<li><p>The system credential store via the keyring package. pak comes with its
own copy of the keyring package, you don't need to install it
separately.</p></li>
</ol><div class="section">
<h4 id="netrc-files"><code>netrc</code> files<a class="anchor" aria-label="anchor" href="#netrc-files"></a></h4>


<p>If the <code>NETRC</code> environment variable is set, pak uses its value to
determine the location of the <code>netrc</code> file.</p>
<p>Otherwise pak looks for the <code>netrc</code> file in current user's home
directory, at <code>~/.netrc</code>. On Windows it also looks for <code>~/_netrc</code> if the
file starting with a dot does not exist.</p>
<p>If you create a <code>netrc</code> file, make sure that is only readable by you.
E.g. on Unix run</p>
<p></p><div class="sourceCode sh"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">chmod</span> 600 ~/.netrc</span></code></pre><p></p></div>
<p><code>netrc</code> files are simple text files that can store passwords for multiple
hosts. They may contain three types of tokens:</p><div class="section">
<h5 id="machine-lt-hostname-gt-"><code>machine &lt;hostname&gt;</code><a class="anchor" aria-label="anchor" href="#machine-lt-hostname-gt-"></a></h5>


<p>A host name, without the protocol. Subsequent <code>login</code> and <code>password</code>
tokens belong to this host, until another <code>machine</code> token is found, or
the end of file.</p>
</div>

<div class="section">
<h5 id="login-lt-username-gt-"><code>login &lt;username&gt;</code><a class="anchor" aria-label="anchor" href="#login-lt-username-gt-"></a></h5>


<p>User name. It must be preceded by a <code>machine</code> token.</p>
</div>

<div class="section">
<h5 id="password-lt-password-gt-"><code>password &lt;password&gt;</code><a class="anchor" aria-label="anchor" href="#password-lt-password-gt-"></a></h5>


<p>Password. It must be preceded by a <code>machine</code> and a <code>login</code> token.</p>
<p>Whitespace is ignored in <code>netrc</code> files. You may include multiple tokens
on the same line, or have one token per line. Here is an example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>machine myhost.mydomain.com login myuser password secret</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>machine myhost2.mydomain.com</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>login myuser</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>password secret</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>login anotheruser</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>password stillsecret</span></code></pre><p></p></div>
<p>If you need to include whitespace in a password, put the password in double
quotes.</p>
</div>


</div>

<div class="section">
<h4 id="the-credential-store">The credential store<a class="anchor" aria-label="anchor" href="#the-credential-store"></a></h4>


<p>pak uses the keyring package to query the system credential store (or an
alternative keyring credential store) to find credentials for authenticated
repositories. pak comes with a copy of the keyring package, so you don't
need to install it separately.</p>
<p>To store a repository password in the system credential store use the
<code><a href="repo_auth_key_get.html">repo_auth_key_set()</a></code> function. If you want to use a non-default keyring
backend, set the <code>keyring_backend</code> option. In this manual we will use
the backend that stores secrets in environment variables. This is an
ephemeral store that is destroyed when the R process terminates.</p>
<p>To continue our example from above:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>keyring_backend <span class="op">=</span> <span class="st">"env"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/repo_auth_key_get.html">repo_auth_key_set</a></span><span class="op">(</span><span class="va">repo</span><span class="op">$</span><span class="fu">url</span><span class="op">(</span><span class="op">)</span>, username <span class="op">=</span> <span class="st">"username"</span>, password <span class="op">=</span> <span class="st">"token"</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Use <code><a href="repo_auth_key_get.html">repo_auth_key_get()</a></code> to check that the key is properly set:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/repo_auth_key_get.html">repo_auth_key_get</a></span><span class="op">(</span><span class="va">repo</span><span class="op">$</span><span class="fu">url</span><span class="op">(</span><span class="op">)</span>, username <span class="op">=</span> <span class="st">"username"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "token"</span></span></code></pre><p></p></div>
<p><code><a href="repo_get.html">repo_get()</a></code> now does not show a warning message, and also sets the
<code>has_password</code> column to <code>TRUE</code>, because pak could find the credentials
for our CRAN proxy:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/repo_get.html">repo_get</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; x Did not find credentials for repo &lt;http://username@127.0.0.1:59571/&gt;, keyring</span></span>
<span><span class="co">#&gt; lookup failed (macos backend).</span></span>
<span><span class="co">#&gt; # A data frame: 6 x 7</span></span>
<span><span class="co">#&gt;   name          url           type  r_version bioc_version username has_password</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;    &lt;lgl&gt;</span></span>
<span><span class="co">#&gt; 1 CRAN          http://usern~ cran  *         &lt;NA&gt;         username FALSE</span></span>
<span><span class="co">#&gt; 2 BioCsoft      https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 3 BioCann       https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 4 BioCexp       https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 5 BioCworkflows https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span>
<span><span class="co">#&gt; 6 BioCbooks     https://bioc~ bioc  4.4.2     3.20         &lt;NA&gt;     NA</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h4 id="repo-vs-host-credentials">Repo vs. host credentials<a class="anchor" aria-label="anchor" href="#repo-vs-host-credentials"></a></h4>


<p>pak handles credentials for repositories and hosts. A repository
credential's key is a URL with a non-empty path:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>repo.host.com<span class="sc">/</span>repos<span class="sc">/</span>repo1</span></code></pre><p></p></div>
<p>A host credential's is an URL with an empty path:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>repo.host.com</span></code></pre><p></p></div>
<p>pak always looks for repository credentials first. If it does not find
any credentials for a repository then it drops the path and looks for
host credentials.</p>
<p>Because <code>netrc</code> files only store domain names and not URLs, they can only
contain host credentials.</p>
</div>


</div>

<div class="section">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>


<p>To test that authentication works, use the <code><a href="repo_status.html">repo_status()</a></code> function:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/repo_status.html">repo_status</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; x Did not find credentials for repo &lt;http://username@127.0.0.1:59571/&gt;, keyring</span></span>
<span><span class="co">#&gt; lookup failed (macos backend).</span></span>
<span><span class="co">#&gt; # A data frame: 12 x 12</span></span>
<span><span class="co">#&gt;    name  url   type  bioc_version username has_password platform path  r_version</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;    &lt;lgl&gt;        &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 CRAN  http~ cran  &lt;NA&gt;         username FALSE        source   src/~ 4.4</span></span>
<span><span class="co">#&gt;  2 CRAN  http~ cran  &lt;NA&gt;         username FALSE        aarch64~ bin/~ 4.4</span></span>
<span><span class="co">#&gt;  3 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           source   src/~ 4.4</span></span>
<span><span class="co">#&gt;  4 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           aarch64~ bin/~ 4.4</span></span>
<span><span class="co">#&gt;  5 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           source   src/~ 4.4</span></span>
<span><span class="co">#&gt;  6 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           aarch64~ bin/~ 4.4</span></span>
<span><span class="co">#&gt;  7 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           source   src/~ 4.4</span></span>
<span><span class="co">#&gt;  8 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           aarch64~ bin/~ 4.4</span></span>
<span><span class="co">#&gt;  9 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           source   src/~ 4.4</span></span>
<span><span class="co">#&gt; 10 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           aarch64~ bin/~ 4.4</span></span>
<span><span class="co">#&gt; 11 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           source   src/~ 4.4</span></span>
<span><span class="co">#&gt; 12 BioC~ http~ bioc  3.20         &lt;NA&gt;     NA           aarch64~ bin/~ 4.4</span></span>
<span><span class="co">#&gt; # i 3 more variables: ok &lt;lgl&gt;, ping &lt;dbl&gt;, error &lt;list&gt;</span></span></code></pre><p></p></div>
<p>The output of <code><a href="repo_status.html">repo_status()</a></code> has extra columns, compared to <code><a href="repo_get.html">repo_get()</a></code>,
and it also has a separate row for each platform. If everything works,
then the <code>has_password</code> column is <code>TRUE</code> for authenticated repositories,
and the <code>ok</code> column is <code>TRUE</code> if <code><a href="repo_status.html">repo_status()</a></code> was able to perform
an (authenticated) HTTP HEAD request to the metadata file of a platform in
a repository.</p>
<p>If you need even more information about repo authentication, e.g. because
<code><a href="repo_status.html">repo_status()</a></code> shows some failures, then use the <code><a href="repo_auth.html">repo_auth()</a></code> function:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/repo_auth.html">repo_auth</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; v Found credentials for repo &lt;http://username@127.0.0.1:59571/&gt; (keyring:env).</span></span>
<span><span class="co">#&gt; # A data frame: 1 x 11</span></span>
<span><span class="co">#&gt;   name  url              type  r_version bioc_version username has_password auth_domains auth_domain</span></span>
<span><span class="co">#&gt; * &lt;chr&gt; &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;    &lt;lgl&gt;        &lt;I&lt;list&gt;&gt;    &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 CRAN  http://username~ cran  *         &lt;NA&gt;         username TRUE         &lt;chr [4]&gt;    http://127~</span></span>
<span><span class="co">#&gt; # i 2 more variables: auth_source &lt;chr&gt;, auth_error &lt;chr&gt;</span></span></code></pre><p></p></div>
<p>The output of <code><a href="repo_auth.html">repo_auth()</a></code> has the following extra columns:</p><ul><li><p><code>auth_domains</code>: these are the URLs that pak tries to use as the <code>service</code>
when looking for credentials in the keyring. For our proxy, it tries
these URLs:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/repo_auth.html">repo_auth</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">auth_domains</span></span>
<span><span class="co">#&gt; v Found credentials for repo &lt;http://username@127.0.0.1:59571/&gt; (keyring:env).</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "http://username@127.0.0.1:59571/" "http://127.0.0.1:59571/"</span></span>
<span><span class="co">#&gt; [3] "http://username@127.0.0.1:59571"  "http://127.0.0.1:59571"</span></span></code></pre><p></p></div></li>
<li><p><code>auth_domain</code>: one of <code>auth_domains</code>, the URL for which pak found
credentials in the keyring. If no credentials were found, then this is
<code>NA</code>.</p></li>
<li><p><code>auth_source</code>: a short string that explains where pak found the
credentials (or <code>NA</code> if not credentials were found). For examples
<code>netrc</code> means the user's <code>netrc</code> file, and <code>keyring:macos</code> means the
macOS system credential store.</p></li>
<li><p><code>auth_error</code>: <code>NA</code> for successful credential search, otherwise a short
error message on why the search failed. Typically it would fail is the
credentials are not in the credential store.</p></li>
</ul></div>

<div class="section">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h3>


<p>Once you set up your authenticated repositories, and stored the required
passwords in the system credential store, you can use them like any
other repository. Operations that need authentication will always include
reassuring messages for successful authentications, and warning messages
for failed ones. Function calls that do not perform any HTTP requests,
e.g. because they list cached data, do not display such messages.</p>
<p></p><div class="sourceCode r"><pre><code>meta_update()
#&gt; Checking for 15 new metadata files
#&gt; ! Cannot find credentials for URL &lt;http://username@127.0.0.1:59571//bin/macosx/big-sur-arm64/contrib/4.4/PACKAGES.gz&gt;, credential lookup
#&gt; failed. Keyring backend: "macos".
#&gt; Checking for 15 new metadata files
x Did not find credentials for repo &lt;http://username@127.0.0.1:59571/&gt;, keyring
#&gt; lookup failed (macos backend).
#&gt;
#&gt; i R 4.4 aarch64-apple-darwin20 packages are missing from CRAN: Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server and Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server
#&gt; i source packages are missing from CRAN: Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server and Failed to connect to 127.0.0.1 port 59571 after 0 ms: Couldn't connect to server
#&gt; i Updating metadata database
#&gt; v Updating metadata database ... done
</code></pre><p></p></div>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/metadata.html">meta_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A data frame: 50,701 x 33</span></span>
<span><span class="co">#&gt;    package    version depends suggests license md5sum sha256sum needscompilation</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 A3         1.0.0   R (&gt;= ~ randomF~ GPL (&gt;~ 929a4~ "\n     ~ no</span></span>
<span><span class="co">#&gt;  2 AATtools   0.0.3   R (&gt;= ~ &lt;NA&gt;     GPL-3   de2ec~ "\n     ~ no</span></span>
<span><span class="co">#&gt;  3 ABACUS     1.0.0   R (&gt;= ~ rmarkdo~ GPL-3   28795~ "\n     ~ no</span></span>
<span><span class="co">#&gt;  4 ABC.RAP    0.9.0   R (&gt;= ~ knitr, ~ GPL-3   0158e~ "\n     ~ no</span></span>
<span><span class="co">#&gt;  5 ABCanalys~ 1.2.1   R (&gt;= ~ &lt;NA&gt;     GPL-3   4cbe1~ "\n     ~ no</span></span>
<span><span class="co">#&gt;  6 ABCoptim   0.15.0  &lt;NA&gt;    testtha~ MIT + ~ a294d~ "\n     ~ yes</span></span>
<span><span class="co">#&gt;  7 ABCp2      1.2     MASS    &lt;NA&gt;     GPL-2   d049b~  &lt;NA&gt;     no</span></span>
<span><span class="co">#&gt;  8 ABHgenoty~ 1.0.1   &lt;NA&gt;    knitr, ~ GPL-3   fce25~ "\n     ~ no</span></span>
<span><span class="co">#&gt;  9 ABM        0.4.3   &lt;NA&gt;    &lt;NA&gt;     GPL (&gt;~ 7aaae~ "\n     ~ yes</span></span>
<span><span class="co">#&gt; 10 ABPS       0.3     &lt;NA&gt;    testthat GPL (&gt;~ d3f00~ "\n     ~ no</span></span>
<span><span class="co">#&gt; # i 50,691 more rows</span></span>
<span><span class="co">#&gt; # i 25 more variables: imports &lt;chr&gt;, linkingto &lt;chr&gt;, archs &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   enhances &lt;chr&gt;, license_restricts_use &lt;chr&gt;, priority &lt;chr&gt;, os_type &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   license_is_foss &lt;chr&gt;, repodir &lt;chr&gt;, rversion &lt;chr&gt;, platform &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   ref &lt;chr&gt;, type &lt;chr&gt;, direct &lt;lgl&gt;, status &lt;chr&gt;, target &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   mirror &lt;chr&gt;, sources &lt;list&gt;, filesize &lt;int&gt;, sha256 &lt;chr&gt;, sysreqs &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   built &lt;chr&gt;, published &lt;dttm&gt;, deps &lt;list&gt;, path &lt;chr&gt;</span></span></code></pre><p></p></div>
<p>E.g. here <code><a href="metadata.html">meta_update()</a></code> outputs an authentication message, but
<code><a href="metadata.html">meta_list()</a></code> does not.</p>
</div>

    </div>


    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other authenticated repositories:
<code><a href="repo_auth.html">repo_auth</a>()</code>,
<code><a href="repo_auth_key_get.html">repo_auth_key_get</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, <a href="https://jimhester.com" class="external-link">Jim Hester</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>, Ascent Digital Services, R Consortium.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

  </div></footer></body></html>

